====== Request ======
  * Nach erfolgter Indizierung der Artikeldaten steht der FINDOLOGIC Such-Service zur Verfügung.
  * Suchanfragen werden mittels HTTP Requests an FINDOLOGIC gesendet.
  * Vor **jeder** eigentlichen Suchanfrage muss ein so genannter //Alivetest// durchgeführt werden.
    * Bei einem negativen Alivetest muss ein Fallback-Mechanismus greifen und die herkömmliche Shopsuche die Suchanfrage verarbeiten.
  * Den Aufbau der Requests und die zugehörigen Parameter finden Sie in folgender Dokumentation.

===== Fallback-Mechanismus =====
  * Vor jeder Suchanfrage wird ein //Alivetest// http Request nach folgendem Schema an FINDOLOGIC gesendet.
    * ''<Serice-URL>/alivetest.php?shopkey=<//Shopkey//>'' (z.B. ''%%http://service.findologic.com/ps/mein-shop.tld/alivetest.php?shopkey=ABCDABCDABCDABCDABCDABCDABCDABCD%%'')
  * Bei der Rückgabe von ''alive'' wird die eigentliche Suchanfrage an den FINDOLOGIC Service gesendet.
  * Bei jeder anderen Rückgabe als ''alive'' wird die Suchanfrage von der herkömmlichen Shopsuche bearbeitet.((Wenn der Fallback-Mechanismus nicht ordnungsgemäß funktioniert **darf** die FINDOLOGIC Suche in keinem produktiven Shop eingesetzt werden.))
  * Ebenfalls muss ein Timeout von 1 Sekunde für den //Alivetest// gesetzt werden. Überschreitet die Antwortzeit 1 Sekunde, wird die Suchanfrage von der herkömmlichen Shopsuche bearbeitet.
  * Für die eigentliche Suchanfrage muss ein Timeout von 3 Sekunden gesetzt werden. Überschreitet die Antwortzeit 3 Sekunden, wird die Suchanfrage von der herkömmlichen Shopsuche bearbeitet.

===== Grundlegender Aufbau des Requests =====

Der Request setzt sich aus folgenden Komponenten zusammen.

  * **[[#service-url|Service-URL]]**
  * **[[#pflichtparameter|Pflichtparameter]]**
    * ''shopkey''
    * ''shopurl''
    * ''userip''
    * ''referer''
    * ''revision''
  * **[[#suchparameter|Suchparameter]]**
    * ''query''
    * ''attrib[]''
    * ''order''
    * ''properties[]''
  * **[[#einschraenkende_paging_parameter|Einschränkung / Paging Parameter]]**
    * ''count''
    * ''first''
    * ''identifier''
    * ''group[]''

===== Service-URL =====

Unter der Service-URL ist der FINDOLOGIC Such-Service anzusprechen.

===== Die Request Parameter im Detail =====

==== Pflichtparameter ====

^ Parameter ^ Kurzbeschreibung ^
| ''shopkey'' | Identifikationsnummer des anfragenden Shops, bestehend aus 32 Hex-Digits |
| ''shopurl'' | Absolute URL des anfragenden Shops |
| ''userip'' ((Für die korrekte Verrechnung notwendig)) ((Zur Verfolgung der Suchhistory)) ((Diese Daten bleiben unter Verschluss!))| IP Adresse des suchenden Users |
| ''referer'' ((Zur Verfolgung der Suchhistory)) ((Diese Daten bleiben unter Verschluss!))| Die Referer url des suchenden Users |
| ''revision'' | Version des Shopmoduls ((z.B. zur Identifikation von Shops, die veraltete Versionen eines Shopmoduls einsetzen)) |

==== Suchparameter ====

^ Parameter ^ Kurzbeschreibung ^
| ''query''| der eigentliche Suchtext |
| ''attrib[<name>][]((hier sind die Array-Klammern ''[]'' nach dem Attribut-Namen stets anzugeben))'' | Liste anzuwendender diskreter Attribut ((Diskrete Attribute können, im Gegensatz zu stetigen Attributen, nur bestimmte Werte annehmen. Z.B. Größe=XL,L,M,...)) Filter |
| ''attrib[<name>][min]'' | Mindestwert eines stetigen Attributes((stetige Attribute können, im Gegensatz zu diskreten Attributen, beliebige Zahlenwerte annehmen. Z.B. price)) |
| ''attrib[<name>][max]'' | Mindestwert eines stetigen Attributes |
| ''order'' | Sortierung der Ergebnisse (siehe unten) |
| ''properties[]'' | Namen der [[fl:csv_format_2_0#optionale_weitere_spalten|zusätzlichen optionalen Export-Spalten]], deren Inhalt ausgegeben werden soll ((nur für XML-Ausgabe relevant)) |

=== Werte des Parameters ''order'' ===

Als Default darf kein Wert gesetzt werden.

^ Wert ^ Bedeutung ^ Anzuzeigende Bezeichnung ^
| ''<leer>''((Alternativ kann auch der Wert ''rank'' angegeben oder der ''order''-Parameter komplett weggelassen werden)) | Von FINDOLOGIC berechnete Relevanz | Beste Treffer |
| ''price ASC'' | Günstigste Produkte zuerst | Günstigste zuerst |
| ''label ASC'' | Alphabetische Sortierung | A-Z |
| ''salesfrequency DESC'' | Verkaufsrang / am häufigsten verkaufte Artikel | Topseller zuerst |
| ''dateadded DESC'' | Neueste Produkte | Neuheiten zuerst |

==== Einschränkende / Paging Parameter ====

^ Parameter ^ Kurzbeschreibung ^ Default Wert ^
| ''count'' | Anzahl der anzuzeigenden Artikel (Seitengröße) ((max. 32767, höhere Werte werden darauf beschränkt)) | ''10'' |
| ''first'' | Erster anzuzeigender Artikel auf der Seite, 0-basiert ((**NICHT** Seitenzahl, sondern Index des Artikels, 0 beginnt die Seite mit dem 1. Artikel, 1 mit dem 2., ''first=count'' zeigt die zweite Seite an; die Seitenzahl ergibt sich somit aus ''first/count+1'')) | ''0'' |
| ''identifier'' | ID eines Artikels, es wird nur dieser Artikel zurückgeliefert (''query'' wird ignoriert) | ''null'' |
| ''group[]((Paramter muss bei XML Export "usergrouphash" lauten, zu beachten: https://secure.findologic.com/dokuwiki/doku.php?id=fl:modul:direct_integration:xml_schema#calculating_the_usergroup-hash_usergroup und https://secure.findologic.com/dokuwiki/doku.php?id=fl:modul:direct_integration:script_integration ))'' | Zu durchsuchende Kundengruppen ((kann mehrfach angegeben werden; es werden nur Artikel angezeigt, die mindestens einer dieser Kundengruppen zugeordnet sind; im Export nicht-existente Gruppen werden ignoriert)) | leere Liste |

===== Filter Anwenden =====

Filterungen der Ergebnismenge erfolgen über den ''attrib'' Parameter.

Name und Wert des Filters sind case-sensitive

==== Kategorie Filter ====

Für Kategorien wird prinzipiell der Schlüssel ''cat'' verwendet.
<code>attrib[cat][]=Herren</code>

=== Hierarchische Kategorien ===

Hierarchien werden entsprechend der Shop Hierarchie mit Unterstrichen ("_") verkettet.
<code>attrib[cat][]=Herren_Hosen</code>

==== Hersteller Filter ====

Für Kategorien wird prinzipiell der Schlüssel ''vendor'' verwendet.
<code>attrib[vendor][]=FINDOLOGIC</code>

==== Preisfilter ====

Der Preisbereich wird durch ''min'' und ''max'' Werte eingeschränkt.
<code>attrib[price][min]=10.5&attrib[price][max]=200.0</code>

==== Attributs Filter ====

Ist das Attribut ''Farbe'' bei Artikeln des Shops hinterlegt kann nach ''Farbe'' wie folgt gefiltert werden.
<code>attrib[Farbe][]=rot</code>

==== Mehrfache Werte eines Filtertyps ====

Mehrfache Filterwerte werden (derzeit) ausschließlich "verundet". Bei mehrfachen Werten eines Filters werden also nur die Produkte ausgegeben, die alle Filter erfüllen.
<code>attrib[Farbe][]=rot&attrib[Farbe][]=blau</code>
In obigem Beispiel werden nur Produkte ausgegeben die rot **und** blau sind.

===== Generierung der Request-URL =====

Alle Parameter Schlüssel und deren Werte müssen UTF-8 und URL kodiert übergeben werden.
<code>attrib[Färbung][]=grün => attrib[F%C3%A4rbung][]=gr%C3%BCn</code>

<note tip>Nutzen Sie bestehende Funktionen, um Fehler zu vermeiden!</note>

Um die Request-URL zu bauen, nutzen Sie nach Möglichkeit bestehende Funktionen. Mit diesen wird der Request automatisch korrekt kodiert.
Unter PHP ist dies z.B. die Funktion [[http://www.php.net/http_build_query|http_build_query]]:

<code php>
$parameters = array(
  'shopkey' => 'ABCD',
  'attrib' => array(
    'cat' => array(
      'Häuser'
    ),
  ...
  ),
);
$requestUrl = 'http://service.findologic.com/ps/mein-shop.de/index.php?' . http_build_query($parameters);
</code>



===== Beispiele =====
Die folgenden Beispiele zeigen einige Suchanfragen:
^ Suche ^ Anfrage ^
| "reifenheber" | ''<ServiceURL>?query=reifenheber'' |
| "reifenheber", "Neuheiten zuerst" | ''<ServiceURL>?query=reifenheber&order=dateadded+DESC'' |
| "reifenheber", Seite 2 (bei 24 Artikel pro Seite) | ''<ServiceURL>?query=reifenheber&first=24'' |
| "reifenheber", eingeschränkt nach Kategorie "Werkzeug" | ''<ServiceURL>?query=reifenheber&attrib[cat][]=Werkzeug'' |
| Alle Artikel der Kategorie "Rennräder" mit der Farbe schwarz (ohne Suchtext) | ''<ServiceURL>?attrib[cat][]=Rennr%C3%A4der&attrib[Farbe][]=schwarz'' |
| "t-shirt", eingeschränkt nach jenen, die es in der Farbe rot und blau gibt | ''<ServiceURL>?query=t-shirt&attrib[Farbe][]=rot&attrib[Farbe][]=blau'' |

====== Weiterführende Dokumentation ======

  * Allgemeines
    * [[fl:integration:eigenes_sonstiges|Übersicht]]
    * [[fl:integration:checklist_modul|Checklist]]
  * Export
    * [[fl:integration:export|Export Dokumentation]]
    * [[fl:csv_format_2_0|CSV Formatbeschreibung]]
  * Request
    * [[fl:integration:request|Dokumentation des Requests]]
  * Rückgabe
    * [[fl:integration:response:xml|Beschreibung des XML Formats]]
    * [[fl:integration:response:html|Dokumentation der HTML Rückgabe]]
    * [[fl:template_manager_2_0|Beschreibung der Templates]]
  * Smart Suggest 
    * [[fl:integration:smart_suggest|Einbindung der Smart Suggest]]
  * Navigation
    * [[fl:navigation|Implementierungsanleitung der Navigation]]