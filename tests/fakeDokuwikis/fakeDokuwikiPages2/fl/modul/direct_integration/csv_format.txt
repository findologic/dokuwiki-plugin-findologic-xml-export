====== CSV-Format ======

Damit FINDOLOGIC die Shopdaten importieren kann, müssen diese in einem vordefinierten Format [[fl:modul:direct_integration:datenexport|bereitgestellt werden]]. 

===== Demo csv =====
  * Eine Demo csv ist hier zu finden: {{:fl:modul:direct_integration:findologic_example.csv|}}

===== Übersicht =====

^ Spaltenname ^ Beschreibung ^ Maximale Länge ^ Pflichtfeld ^ Durchsuchbar ^
^**''[[#id]]''**|Eindeutige Identifizierungsnummer des Artikels | 255 | Ja | Nein |
^**''[[#ordernumber]]''**|Artikelnummer(n) / SKU(s) des Artikels | 80 | Ja | Ja |
^**''[[#name]]''**|Artikelname, wie er in der Suche erscheinen soll | 1GB | Ja | Ja |
^**''[[#summary]]''**|Artikelkurzbeschreibung, die optional angezeigt werden kann | 1GB | Nein | Ja |
^**''[[#description]]''**|Detaillierte Artikelbeschreibung.| 1GB | Nein | Ja |
^**''[[#price]]''**|Aktuell gültiger Verkaufspreis inkl. Steuern, z.B. Aktionspreis. Dies ist die Standardausgabe, falls für den Benutzergruppen-Hash keine gesonderte Preispalte übergeben wird.| 10.2 | Ja | Nein |
^**''[[#usergroup_price]]''**|JSON kodiertes Objekt aller für Kundengruppenkonstellationen abweichenden Preise inkl. Steuern | 1GB | Nein | Nein |
^**''[[#instead]]''**|Normalpreis des Artikels inkl. Steuern| 10.2 | Nein | Nein |
^**''[[#maxprice]]''**|Aktuell gültiger Verkaufspreis mit der teuersten Option inkl. Steuern | 10.2 | Nein | Nein |
^**''[[#taxrate]]''**|Steuersatz des Artikels | 10.2 | Ja | Nein |
^**''[[#url]]''**|Absoluter oder relativer Link auf die Artikeldetail-Seite | 1023 | Ja | Nein |
^**''[[#image]]''**|Absoluter oder relativer Link auf das Artikelbild, am besten in Thumbnailgröße | 1023 | Ja | Nein |
^**''[[#attributes]]''**|Kategorien und Attribute des Artikels| 1GB | Ja | Ja |
^**''[[#keywords]]''**|Keywords die dem Produkt zugeordnet sind | 1GB | Nein | Ja |
^**''[[#groups]]''**|Benutzergruppen-Hashes, denen der Artikel zugeordnet ist | 1GB | Nein | Nein |
^**''[[#bonus]]''**|Bonuswert um Produkte im Ranking höher zu werten| 10.2 | Nein | Nein |
^**''[[#sales_frequency]]''**|Verkaufszahl des Artikels | 2147483647 | Nein | Nein |
^**''[[#date_added]]''**|Wann der Artikel hinzugefügt wurde | 2147483647 | Nein | Nein |
^**''[[#sort]]''**|Ein beliebiger Wert, der zur Sortierung der Artikel verwendet werden kann | 2147483647 | Nein | Nein |
^**''[[#optionale_weitere_spalten|...]]''**| weitere Spalten können frei definiert werden| | Nein | Nein |

===== Formatierung der CSV-Datei =====
  * Die CSV-Datei muss **UTF-8** codiert sein
  * Die Spalten sind durch das **Tabulator-Zeichen** (''\t'') getrennt
  * Die **erste Zeile** muss die **Spaltennamen** enthalten, wie sie in obiger Tabelle zu finden sind, dabei müssen **alle obligatorischen Spalten** enthalten sein
  * Die **Spaltennamen** dürfen **nicht zwischen Anführungszeichen** stehen
  * Die Zeilen sind mit **Newline** (''\n'') getrennt((Nicht Carriage Return))
  * Falls der Textwert einer Spalte mehrere Worte enthält, muss er unter **doppelten Anführungszeichen** (''"'', Codepoint: 0x22) stehen
  * Steuerzeichen (**Zeilenumbruch** (''\n''), **Tabulator** (''\t''), etc.) müssen in den Inhalten durch Leerzeichen ersetzt werden
  * **Escape-Sequenzen** werden wie in C/C++/Java/php verwendet z.B.: "Ein 17\" Monitor"


===== Die Felder im Detail =====
==== id ====
Eindeutige Identifizierungsnummer des Artikels
    * darf Buchstaben und Ziffern enthalten
    * darf aber nicht länger als 255 Zeichen sein.
    * muss eindeutig sein; bei mehrfachem Auftreten der gleichen ID wird nur der erste Artikel mit dieser ID importiert

==== ordernumber ====
Artikelnummer(n) / SKU(s) des Artikels
    * kann auch Buchstaben und Trennzeichen (bis auf "''|''" Pipe, und '#') enthalten
    * es können mehrere durch "''|''" oder "''#''" getrennte Artikelnummern angegeben werden, z.B. für Slave- / Child-Artikelnummern, SKU, EAN/ISBN
    * die Beschränkung auf 80 Zeichen bezieht sich auf eine einzelne Artikelnummer, mehrere durch "''|''" getrennte Artikelnummern dürfen jeweils bis zu 80 Zeichen lang sein
    * Beispiel: ''0815|ABC123'' oder ''0815#ABC123''
    * Artikelnummern werden **nicht-fehlertolerant** durchsucht
    * um weitere Variationen der Artikelnummer finden zu können fügen Sie diese als eigene Variationen hinzu (z.B. ''08151234|0815'' falls Artikelnummern auch über die ersten 4 Stellen gefunden werden sollen)

==== summary ====
Artikelkurzbeschreibung
    * darf keine html oder xml Formatierung enthalten

==== description ====
Detaillierte Artikelbeschreibung
    * darf keine html oder xml Formatierung enthalten

==== price ====
Der **Brutto-Preis** (also inkl. Steuern) zu dem der jeweilige Artikel angeboten wird.
    * als Dezimaltrennzeichen muss der Punkt (''.'') verwendet werden
    * keine Tausender Trennzeichen
    * für spezielle Fälle (z.B. CMS- / Intranet-Suche) wird die Spalte mit ''0.0'' aufgefüllt

==== usergroup_price ====

JSON kodiertes Objekt aller für Kundengruppenkonstellationen abweichenden Preise inkl. Steuern. 

Der **Brutto-Preis** (also inkl. Steuern) zu dem der jeweilige Artikel für die im Namen angegebene Benutzergruppe angeboten wird.
    * als Dezimaltrennzeichen muss der Punkt (''.'') verwendet werden
    * keine Tausender Trennzeichen

Beispielcode:
<code>
{
    "Benutzergruppen-Hash": 0.00,
    "asdf1234": 5.99,
    "qwer5678": 9.99
}
</code>

Mehr zur [[#berechnung_des_benutzergruppen-hash|Berechnung des Benutzergruppen-Hash]] finden Sie hier.

<note important>Beachten Sie: Die doppelten Anführungszeichen ''"'' im JSON-Objekt müssen escaped werden: ''\"''</note>

==== instead ====
Der Brutto-Statt-Preis des jeweiligen Produktes. Dieser dient zur Anzeige von Angeboten. Zum Beispiel "39 EUR statt vorher 59 EUR": ''price="39.00", instead="59.00"''
    * als Dezimaltrennzeichen muss der Punkt (''.'') verwendet werden
    * keine Tausender Trennzeichen
    * für spezielle Fälle (z.B. CMS- / Intranet-Suche) wird die Spalte mit ''0.0'' aufgefüllt

==== maxprice ====
Der Maximalpreis des jeweiligen Produktes. Dies dient zur Anzeige von Preisen ab einem Grundpreis. Zum Beispiel "ab 29 EUR": ''price="29.00", maxprice="39.00"''
    * als Dezimaltrennzeichen muss der Punkt (''.'') verwendet werden
    * keine Tausender Trennzeichen
    * für spezielle Fälle (z.B. CMS- / Intranet-Suche) wird die Spalte mit ''0.0'' aufgefüllt

==== taxrate ====
Steuersatz des jeweiligen Artikels, z.B. ''19'' für 19% MwSt.
    * **ohne %-Zeichen**
    * bleibt die Spalte leer, wird von 19% ausgegangen

==== url ====
Die URL zu der Artikelseite des jeweiligen Artikels
  * relative URLs beziehen sich auf die Position der Suchergebnisseite des Shops.

==== image ====
Die URL zu einer Abbildung des Artikels
  * relative URLs beziehen sich auf die Position der Suchergebnisseite des Shops

==== attributes ====
Das Feld ''attributes'' beinhaltet alle Werte die für eine Filterung geeignet sein können. Wie: Kategorien, Attribute, Hersteller, Merkmale etc.
    * Attribute werden im URL-Stil angegeben als Schlüssel-Wert-Paare angegeben: ''Material=Holz&Material=Metall&Farbe=rot&Farbe=blau''
    * **WICHTIG: Für die Schlüssel und Werte ist das URL-Encoding zu verwenden, Umlaute inkl. //ß// sowie die Trennzeichen ''&'' und ''='' müssen kodiert angegeben werden!**
      * Beispiel für Kategorie "Fahrräder" und Hersteller "Schulz & Partner": ''cat=Fahrr%C3%A4der&vendor=Schulz+%26+Partner''
    * **WICHTIG: Die Schlüssel und Werte müssen vor URL-Kodierung UTF-8 kodiert sein**
      * Bei korrekter Kodierung werden Umlaute und Sonderzeichen durch spezielle Sequenzen mit zwei Prozentzeichen ersetzt, z.B. ''ä'' => ''%C3%A4''
    * Attribut-Namen und -Werte sind nicht Case-Sensitive: ''Farbe'' und ''farbe'' sowe ''xl'' und ''XL'' werden identisch behandelt. Zur Darstellung wird die Groß/Kleinschreibung des ersten Vorkommens verwendet.
    * Attribute aller Namen können mehrfache Werte haben. Z.B.: ''Farbe=rot&Farbe=blau'', wenn der Artikel sowohl mit dem Farb-Filter ''rot'' als auch mit dem Farb-Filter ''blau'' gefunden werden soll
    * Optional können an die Schlüssel auch eckige Klammern angehängt werden: ''cat[]='' (dies hat keinen Einfluss auf das Verhalten)
== Kategorien ==
    * Kategorien werden mit dem speziellen Schlüssel ''cat'' (wie //category//) angegeben
      * Unterkategorien werden dabei mit dem Unterstrich ''_'' voneinander getrennt, der nicht URL-Codiert sein darf.
      * Ist der Unterstrich Teil des Kategorienamens, muss dieser durch ein anderes Zeichen ersetzen werden (z.B. ''-'')
      * Z.B.: Ein Artikel, der in der Kategorie //Bekleidung > Herren//, sowie in der Kategorie //Sonderangebote// eingeordnet ist, hat folgende Kategorieattribute: ''cat=Bekleidung_Herren&cat=Sonderangebote''
      * Sollte keine Hierarchie / Baumstruktur vorhanden sein, können Kategorien auch flach organisiert sein.
      * Wird keine Kategorie angegeben, wird ein sinnvoller Teil des Namens als Kategorie verwendet.
== Hersteller ==
    * Zuordnungen zu Herstellern bzw. Marken werden mit dem speziellen Schlüssel ''vendor'' angegeben
      * Z.B.: ''vendor=Shimano''

==== keywords ====
Schlüsselwörter zum jeweiligen Artikel. Die Relevanz der Keywords ist die selbe wie des Titels und ist entsprechend ein gewichtiger Faktor für gute Ergebnisse.
    * Werden durch Komma ("'',''") getrennt

==== groups ====
Mit dem Parameter ''groups'' können Benutzergruppen abgebildet werden. Bei der Suche kann mittels Parameter eine Einschränkung auf Basis dieser Werte erfolgen.
    * Bei den Werten für die Gruppe handelt es sich um Strings
    * Einträge werden durch Komma getrennt
    * Z.B. ''a12f,b78d,o98v,...''
    * Es werden maximal 4.096 Gruppen pro Artikel unterstützt
    * Für die Berechnung des Benutzergruppen-Hashes siehe hier: [[https://secure.findologic.com/dokuwiki/doku.php?id=fl:modul:direct_integration:csv_format#berechnung_des_benutzergruppen-hash|Berechnung des Benutzergruppen-Hash]]

==== bonus ====
Mit dem Feld Bonus kann das Ranking eines Artikels beeinflusst werden.
    * Das intern berechnete Ranking wird mit ''(1 + bonus)'' multipliziert; ein Wert von 1 führt somit zu einer Verdopplung der Relevanz
    * Negative Werte sind ebenso zulässig, die Produkte werden dann entsprechend geringer gewertet
    * Um ein Produkt besser  zu reihen, empfehlen wir einen Bonus-Wert von 1 bis 3
    * Um ein Produkt weniger gut zu reihen, empfehlen wir einen Bonus-Wert von 0 bis -0.9

==== sales_frequency ====
Absolute Anzahl der verkauften Einheiten des Artikels
    * Ganze Zahl >= 0
    * Fließt in die Relevanz ein und erhöht somit das Ranking der Topseller
    * Kann als Sortierkriterium verwendet werden

==== date_added ====
Zeitpunkt, zu dem der Artikel zum Shop hinzugefügt wurde
    * der Zeitpunkt wird als ganzzahlige Zahl angegeben, die die Sekunden ab dem 01.01.1970 angibt, s. auch [[wpde>Unixzeit]]
    * kann zur Sortierung verwendet werden

==== sort ====
Beliebiger ganzzahliger Wert zur Sortierung
    * Artikel können entsprechend dem Wert dieser Spalte auf- oder absteigend sortiert werden
    * kann je nach Shopsystem unterschiedliche Bedeutung haben

==== optionale weitere Spalten ====
Können beliebige Namen haben, verschieden von den hier angeführten Spalten
    * der Textwert wird gespeichert aber für die Suche nicht verwendet
    * diese Informationen können bei der Anzeige der Produkte verwendet werden
    * z.B.: optionale Detailbild-urls, Artikelvideo-urls, Lagerbestand, ...

===== Berechnung des Benutzergruppen-Hash =====

Der Benutzergruppen-Hash setzt sich aus zwei Komponenten zusammen:

  * Der Shopkey (z.B. ''ABCD0815'')
  * Die kombinierten Kundengruppen (z.B. 'at_fsk18')

Diese Komponenten werden mit ''xor'' und base64 miteinander verrechnet und sind somit dekodierbar. Die Kodierung soll eine Manipulation der Suchanfragen verhindern (z.B. FSK18).

=== Beispiel: ===
 
<code php>
$shopkey = 'ABCD0815';
$usergroup = 'at_fsk18';
$hash = base64_encode($shopkey ^ $usergroup); // = 'NDEmNgEN'

$usergroup_decoded = ($shopkey ^ base64_decode($hash)); // = 'at_fsk18';
</code>


===== XML-Format =====
Export erweitern (Dokumentation)
  * neuheit (0/1 URL)
  * angebot 0/1 oder URL)
  * sale (0/1 oder URL)
  * versandkostenfrei (0/1 oder URL)
  * logo (URL)
  * verfügbarkeit (HTML)
  * lieferdauer (HTML)
  * bewertungpunkte (FLOAT)
  * bewertunganzahl (INT)
  * Rabatt (FLOAT)
  * Grundpreis Preis (FLOAT)
  * Grundpreis Einheit (CHAR)
  * Staffelpreis-Tabelle (HTML)
  * cat_url für Einbindung der Navigation

! vorsehen, dass eine "optimize" funktion z.B. eines SEO-Moduls zwischengeschalten werden kann:

function changeURL ($val) {
// do whatever you need to do
return $val;
}

Erweiterbarkeit mit einer "blinden" funktion vorsehen

/*
function addColumn($colName, $colValue) {
// wie wird der Export erweitert?
return true;
}
*/

===== Übersicht =====

  * [[:fl:modul:direct_integration:konfiguration_im_shopbackend|Konfiguration im Shopbackend]]
  * ** Export **
    * [[:fl:modul:direct_integration:datenexport|Datenexport]]
    * CSV-Format
  * [[:fl:modul:direct_integration:integration_des_skripts|Integration des Skripts]]
  * [[:fl:modul:direct_integration:tracking_integration|Tracking-Integration]]
  * [[:fl:modul:direct_integration:checkliste|Checkliste zur Abnahme]]